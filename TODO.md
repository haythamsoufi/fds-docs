# RAG Upgrade TODOs

- [x] Implement token-based, sentence-aware splitter with configurable overlap
- [x] Preserve structural metadata (headers, pages, sections) in chunk metadata
- [x] Normalize and clean extracted text; remove boilerplate and artifacts
- [ ] Deduplicate near-duplicate chunks using MinHash or SimHash
- [x] Deduplicate near-duplicate chunks using MinHash or SimHash
- [x] Upgrade to BGE/E5 embedding models for passages and queries
- [x] Add instruction formatting for query and passage embeddings
- [x] Version embedding cache keys and implement re-embedding workflow
- [x] L2-normalize embeddings before indexing to vector store
- [x] Tune vector store HNSW params and enable metadata indexing
- [x] Migrate existing vectors to new schema and consistent IDs
- [x] Add background workers for batch embedding and indexing
- [x] Implement BM25 keyword search and hybrid RRF fusion
- [x] Apply MMR diversification to reduce duplicate results
- [x] Support metadata filters and field boosts in retrieval
- [x] Integrate cross-encoder reranker over top-N retrieved chunks
- [x] Redesign grounded prompt with citations and refusal rules
- [x] Pack concise, source-labeled context blocks for the LLM
- [x] Add no-answer threshold and calibrated confidence scoring
- [x] Add RAGAS evaluation pipeline and sample labeled dataset
- [x] Instrument retrieval and generation metrics with dashboards
- [x] Cache query embeddings and top-k results with TTL
- [x] Add backpressure and retry logic for vector DB I/O
- [x] Enable OCR for scanned PDFs and extract tables reliably
- [x] Externalize model and index settings via environment
- [x] Add admin endpoints for reindex, reembed, and cache control
- [x] Update UI to show citations and expandable evidence blocks
- [x] Document upgrade plan, migrations, and rollback procedures
